<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="baidu-site-verification" content="Yu0REDPjKL">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="反射,">










<meta name="description" content="反射成员在上一节中，我们介绍了反射的Class的获取以及Field，method，construct的获取，在我们拿到这些信息后如何修改呢？ 下面我将会和大家一起探索反射后信息的使用。 字段（Field）什么是字段？字段是一个类，接口或者枚举和其相关的值，java.lang.reflect.Field中相关的方法可以取到字段的信息，例如名字、类型、修饰符和注解。还有一些方法可以实现动态访问，和修改">
<meta name="keywords" content="反射">
<meta property="og:type" content="article">
<meta property="og:title" content="反射三步曲之二反射字段、方法、构造函数">
<meta property="og:url" content="https://tianhao.info/2018/08/18/Reflect-2/index.html">
<meta property="og:site_name" content="非淡泊无以明志，非宁静无以致远.">
<meta property="og:description" content="反射成员在上一节中，我们介绍了反射的Class的获取以及Field，method，construct的获取，在我们拿到这些信息后如何修改呢？ 下面我将会和大家一起探索反射后信息的使用。 字段（Field）什么是字段？字段是一个类，接口或者枚举和其相关的值，java.lang.reflect.Field中相关的方法可以取到字段的信息，例如名字、类型、修饰符和注解。还有一些方法可以实现动态访问，和修改">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-03-25T03:16:15.768Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="反射三步曲之二反射字段、方法、构造函数">
<meta name="twitter:description" content="反射成员在上一节中，我们介绍了反射的Class的获取以及Field，method，construct的获取，在我们拿到这些信息后如何修改呢？ 下面我将会和大家一起探索反射后信息的使用。 字段（Field）什么是字段？字段是一个类，接口或者枚举和其相关的值，java.lang.reflect.Field中相关的方法可以取到字段的信息，例如名字、类型、修饰符和注解。还有一些方法可以实现动态访问，和修改">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>



  <link rel="canonical" href="https://tianhao.info/2018/08/18/Reflect-2/">





  <title>反射三步曲之二反射字段、方法、构造函数 | 非淡泊无以明志，非宁静无以致远.</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	<a href="https://your-url" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">非淡泊无以明志，非宁静无以致远.</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Subtitle</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>
            
            日程表
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://tianhao.info/2018/08/18/Reflect-2/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="田昊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="非淡泊无以明志，非宁静无以致远.">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">反射三步曲之二反射字段、方法、构造函数</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-18T09:46:17+08:00">
                2018-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/18/Reflect-2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/08/18/Reflect-2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  8.8k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  43
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="反射成员"><a href="#反射成员" class="headerlink" title="反射成员"></a>反射成员</h1><p>在上一节中，我们介绍了反射的Class的获取以及Field，method，construct的获取，在我们拿到这些信息后如何修改呢？</p>
<p>下面我将会和大家一起探索反射后信息的使用。</p>
<h2 id="字段（Field）"><a href="#字段（Field）" class="headerlink" title="字段（Field）"></a>字段（Field）</h2><h3 id="什么是字段？"><a href="#什么是字段？" class="headerlink" title="什么是字段？"></a>什么是字段？</h3><div class="note info ">字段是一个类，接口或者枚举和其相关的值，java.lang.reflect.Field中相关的方法可以取到字段的信息，例如名字、类型、修饰符和注解。还有一些方法可以实现动态访问，和修改字段的值。</div>

<h3 id="获取字段的类型"><a href="#获取字段的类型" class="headerlink" title="获取字段的类型"></a>获取字段的类型</h3><p>一个字段可能是基本类型也可能是引用类型，前文也介绍了Java有八种基本类型boolean、byte、short、int 、long、char、float、double，引用类型呢？它是直接或者间接继承了<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html" target="_blank" rel="noopener"><code>java.lang.Object</code></a>的类型，包括接口，和枚举。</p>
<p>下面这一段代码展示了字段类型，完全限定的二进制名和类名获取的类型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldSpy</span>&lt;T&gt; &#123;</span></span><br><span class="line">    <span class="keyword">public</span> boolean[][] b = &#123;&#123; <span class="literal">false</span>, <span class="literal">false</span> &#125;, &#123; <span class="literal">true</span>, <span class="literal">true</span> &#125; &#125;;</span><br><span class="line">    <span class="keyword">public</span> String name  = <span class="string">"Alice"</span>;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="built_in">list</span>;</span><br><span class="line">    <span class="keyword">public</span> T val;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//获取类</span></span><br><span class="line">	    Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">	    <span class="comment">//获取类的字段</span></span><br><span class="line">	    Field f = c.getField(args[<span class="number">1</span>]);</span><br><span class="line">	    <span class="comment">//打印声明类型</span></span><br><span class="line">	    System.out.format(<span class="string">"Type: %s%n"</span>, f.getType());</span><br><span class="line">	    <span class="comment">//打印字段泛型</span></span><br><span class="line">	    System.out.format(<span class="string">"GenericType: %s%n"</span>, f.getGenericType());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (NoSuchFieldException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们分别传入相应的参数</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">fieldSpy</span><span class="selector-class">.fieldSpy</span>("<span class="selector-tag">lab</span><span class="selector-class">.mon</span><span class="selector-class">.actlab</span><span class="selector-class">.java</span><span class="selector-class">.reflect</span><span class="selector-class">.FieldSpy</span>","<span class="selector-tag">b</span>");</span><br><span class="line"><span class="selector-tag">fieldSpy</span><span class="selector-class">.fieldSpy</span>("<span class="selector-tag">lab</span><span class="selector-class">.mon</span><span class="selector-class">.actlab</span><span class="selector-class">.java</span><span class="selector-class">.reflect</span><span class="selector-class">.FieldSpy</span>","<span class="selector-tag">Alice</span>");</span><br><span class="line"><span class="selector-tag">fieldSpy</span><span class="selector-class">.fieldSpy</span>("<span class="selector-tag">lab</span><span class="selector-class">.mon</span><span class="selector-class">.actlab</span><span class="selector-class">.java</span><span class="selector-class">.reflect</span><span class="selector-class">.FieldSpy</span>","<span class="selector-tag">list</span>");</span><br><span class="line"><span class="selector-tag">fieldSpy</span><span class="selector-class">.fieldSpy</span>("<span class="selector-tag">lab</span><span class="selector-class">.mon</span><span class="selector-class">.actlab</span><span class="selector-class">.java</span><span class="selector-class">.reflect</span><span class="selector-class">.FieldSpy</span>","<span class="selector-tag">val</span>");</span><br></pre></td></tr></table></figure>
<p>然后得到以下信息</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Type: class [[Z</span><br><span class="line">GenericType: class [[Z</span><br><span class="line">Type: class java<span class="selector-class">.lang</span><span class="selector-class">.String</span></span><br><span class="line">GenericType: class java<span class="selector-class">.lang</span><span class="selector-class">.String</span></span><br><span class="line">Type: interface java<span class="selector-class">.util</span><span class="selector-class">.List</span></span><br><span class="line">GenericType: java<span class="selector-class">.util</span><span class="selector-class">.List</span>&lt;java<span class="selector-class">.lang</span><span class="selector-class">.Integer</span>&gt;</span><br><span class="line">Type: class java<span class="selector-class">.lang</span><span class="selector-class">.Object</span></span><br><span class="line">GenericType: T</span><br></pre></td></tr></table></figure>
<p>这里看到对于数组，拿到的是完全限定名</p>
<p>val字段的为Object，因为泛型是要做类型擦除（type erasure）的，会在编译时会删除有关泛型的所有信息。</p>
<p>因此T被类型上限所取代，在这里是Object。</p>
<p>getGenericType()方法会拿到类的签名属性，如果属性不存在，它将执行Field.getType()方法。</p>
<h3 id="取得、解析字段的修饰符"><a href="#取得、解析字段的修饰符" class="headerlink" title="取得、解析字段的修饰符"></a>取得、解析字段的修饰符</h3><p>在上一篇中，我们介绍了怎么取得类的修饰符，下面介绍一下字段的修饰符</p>
<ul>
<li>访问修饰符： public 、protected 、private</li>
<li>字段特定的运行行为修饰符：transient和volatile</li>
<li>修饰一个实例：static</li>
<li>修饰不允许修改的修饰符：final</li>
<li>注解</li>
</ul>
<p>Field.getModifiers()方法将会返回一个声明为set的修饰符，这些修饰符定义在<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Modifier.html" target="_blank" rel="noopener"><code>java.lang.reflect.Modifier</code></a></p>
<p>下面来介绍一段例子来打印出字段的修饰符：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> Spy &#123; BLACK , WHITE &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FieldModifierSpy</span> &#123;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">int</span> share;</span><br><span class="line">    <span class="keyword">int</span> instance;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Inner</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fieldModifierSpy</span>(<span class="params">String... args</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取类中的Class</span></span><br><span class="line">            Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">int</span> searchMods = <span class="number">0x0</span>;</span><br><span class="line">            <span class="comment">//解析传入的类型</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">                searchMods |= modifierFromString(args[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//获取类的所有字段</span></span><br><span class="line">            Field[] flds = c.getDeclaredFields();</span><br><span class="line">            <span class="comment">//打印出类名，和搜索模式</span></span><br><span class="line">            <span class="keyword">out</span>.format(<span class="string">"Fields in Class '%s' containing modifiers:  %s%n"</span>, c.getName(), Modifier.toString(searchMods));</span><br><span class="line">            boolean found = <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">//遍历字段</span></span><br><span class="line">            <span class="keyword">for</span> (Field f : flds) &#123;</span><br><span class="line">                <span class="comment">//获取字段的修饰符</span></span><br><span class="line">                <span class="keyword">int</span> foundMods = f.getModifiers();</span><br><span class="line">                <span class="comment">// Require all of the requested modifiers to be present</span></span><br><span class="line">                <span class="keyword">if</span> ((foundMods &amp; searchMods) == searchMods) &#123;</span><br><span class="line">                    <span class="comment">//查找并打印出相应的修饰符</span></span><br><span class="line">                    <span class="keyword">out</span>.format(<span class="string">"%-8s [ synthetic=%-5b enum_constant=%-5b ]%n"</span>, f.getName(), f.isSynthetic(), f.isEnumConstant());</span><br><span class="line">                    found = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!found) &#123;</span><br><span class="line">                <span class="keyword">out</span>.format(<span class="string">"No matching fields%n"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">modifierFromString</span>(<span class="params">String s</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">0x0</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"public"</span>.<span class="keyword">equals</span>(s))           m |= Modifier.PUBLIC;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"protected"</span>.<span class="keyword">equals</span>(s))   m |= Modifier.PROTECTED;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"private"</span>.<span class="keyword">equals</span>(s))     m |= Modifier.PRIVATE;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"static"</span>.<span class="keyword">equals</span>(s))      m |= Modifier.STATIC;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"final"</span>.<span class="keyword">equals</span>(s))       m |= Modifier.FINAL;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"transient"</span>.<span class="keyword">equals</span>(s))   m |= Modifier.TRANSIENT;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"volatile"</span>.<span class="keyword">equals</span>(s))    m |= Modifier.VOLATILE;</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们来往里面传递不同的参数试一试，首先传递</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">fieldModifierSpy</span><span class="selector-class">.fieldModifierSpy</span>(<span class="selector-tag">FieldModifierSpy</span><span class="selector-class">.Inner</span><span class="selector-class">.class</span><span class="selector-class">.getName</span>(),"<span class="selector-tag">volatile</span>");</span><br><span class="line"><span class="selector-tag">fieldModifierSpy</span><span class="selector-class">.fieldModifierSpy</span>(<span class="selector-tag">Spy</span><span class="selector-class">.class</span><span class="selector-class">.getName</span>(),"<span class="selector-tag">public</span>");</span><br><span class="line"><span class="selector-tag">fieldModifierSpy</span><span class="selector-class">.fieldModifierSpy</span>(<span class="selector-tag">FieldModifierSpy</span><span class="selector-class">.Inner</span><span class="selector-class">.class</span><span class="selector-class">.getName</span>(),"<span class="selector-tag">final</span>");</span><br><span class="line"><span class="selector-tag">fieldModifierSpy</span><span class="selector-class">.fieldModifierSpy</span>(<span class="selector-tag">Spy</span><span class="selector-class">.class</span><span class="selector-class">.getName</span>(),"<span class="selector-tag">public</span>","<span class="selector-tag">private</span>","<span class="selector-tag">static</span>","<span class="selector-tag">final</span>");</span><br></pre></td></tr></table></figure>
<p>得到结果</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">I:</span> Fields <span class="keyword">in</span> Class <span class="string">'lab.mon.actlab.java.reflect.FieldModifierSpy'</span> containing <span class="string">modifiers:</span>  </span><br><span class="line"><span class="string">I:</span> instance [ synthetic=<span class="literal">false</span> enum_constant=<span class="literal">false</span> ]</span><br><span class="line"><span class="string">I:</span> share    [ synthetic=<span class="literal">false</span> enum_constant=<span class="literal">false</span> ]</span><br><span class="line"><span class="string">I:</span> $change  [ synthetic=<span class="literal">true</span>  enum_constant=<span class="literal">false</span> ]</span><br><span class="line"><span class="string">I:</span> serialVersionUID [ synthetic=<span class="literal">false</span> enum_constant=<span class="literal">false</span> ]</span><br><span class="line"><span class="string">I:</span> Fields <span class="keyword">in</span> Class <span class="string">'lab.mon.actlab.java.reflect.Spy'</span> containing <span class="string">modifiers:</span>  <span class="keyword">public</span></span><br><span class="line"><span class="string">I:</span> $change  [ synthetic=<span class="literal">true</span>  enum_constant=<span class="literal">false</span> ]</span><br><span class="line"><span class="string">I:</span> BLACK    [ synthetic=<span class="literal">false</span> enum_constant=<span class="literal">true</span>  ]</span><br><span class="line"><span class="string">I:</span> WHITE    [ synthetic=<span class="literal">false</span> enum_constant=<span class="literal">true</span>  ]</span><br><span class="line"><span class="string">I:</span> Fields <span class="keyword">in</span> Class <span class="string">'lab.mon.actlab.java.reflect.FieldModifierSpy$Inner'</span> containing <span class="string">modifiers:</span>  <span class="keyword">final</span></span><br><span class="line"><span class="string">I:</span> <span class="keyword">this</span>$<span class="number">0</span>   [ synthetic=<span class="literal">true</span>  enum_constant=<span class="literal">false</span> ]</span><br><span class="line"><span class="string">I:</span> serialVersionUID [ synthetic=<span class="literal">false</span> enum_constant=<span class="literal">false</span> ]</span><br><span class="line"><span class="string">I:</span> Fields <span class="keyword">in</span> Class <span class="string">'lab.mon.actlab.java.reflect.Spy'</span> containing <span class="string">modifiers:</span>  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span></span><br><span class="line"><span class="string">I:</span> $VALUES  [ synthetic=<span class="literal">true</span>  enum_constant=<span class="literal">false</span> ]</span><br></pre></td></tr></table></figure>
<p>注意到，有些字段没有声明，但是出现在了输出字段中，这是因为编译器在运行时会生成一些合成字段。</p>
<p>如果要判断某些字段是否是合成字段，要使用方法<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Field.html#isSynthetic--" target="_blank" rel="noopener"><code>Field.isSynthetic()</code></a>，合成字段依赖于编译器，我们常见的合成字段为<code>this$0</code>引用外部的封闭类。</p>
<p>输出的另一个地方<code>$VALUES</code>用于枚举，来隐士的实现静态方法<code>values()</code>。并且合成字段在编译阶段和发布阶段很有可能不同。</p>
<p>并且这些字段在<code>Class.getDeclaredField()</code>中以数组的方式返回。但是在Class.getField()中不会返回，因为他们不是<code>public</code>类型。</p>
<h3 id="get或者set-字段的值"><a href="#get或者set-字段的值" class="headerlink" title="get或者set 字段的值"></a>get或者set 字段的值</h3><div class="note info">在一些不允许改变其值的地方，我们有时会为了设计必须改变它的值。但是这通常违反了设计者的意图，这一操作需要极其慎重</div>

<p>下面这段<code>Book</code>代码展示了如何对<code>long</code>,<code>array</code>,<code>enum</code>赋值，对于其他基本类型的赋值，可以查阅<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Field.html#method_summary" target="_blank" rel="noopener"><code>Field</code></a>的方法。</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Tweedle</span> &#123;</span> DEE, DUM &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> long chapters = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span>[] characters = &#123; <span class="string">"Alice"</span>, <span class="string">"White Rabbit"</span> &#125;;</span><br><span class="line">    <span class="keyword">public</span> Tweedle twin = Tweedle.DEE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> void main(<span class="keyword">String</span>... args) &#123;</span><br><span class="line">        Book book = <span class="keyword">new</span> <span class="type">Book</span>();</span><br><span class="line">        <span class="keyword">String</span> fmt = <span class="string">"%6S:  %-12s = %s%n"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//拿到book类</span></span><br><span class="line">            Class&lt;?&gt; c = book.getClass();</span><br><span class="line">            <span class="comment">//拿到chapters</span></span><br><span class="line">            Field chap = c.getDeclaredField(<span class="string">"chapters"</span>);</span><br><span class="line">            out.format(fmt, <span class="string">"before"</span>, <span class="string">"chapters"</span>, book.chapters);</span><br><span class="line">            <span class="comment">//设置chapters的值</span></span><br><span class="line">            chap.setLong(book, <span class="number">12</span>);</span><br><span class="line">            out.format(fmt, <span class="string">"after"</span>, <span class="string">"chapters"</span>, chap.getLong(book));</span><br><span class="line">            <span class="comment">//拿到数组characters的值</span></span><br><span class="line">            Field chars = c.getDeclaredField(<span class="string">"characters"</span>);</span><br><span class="line">            out.format(fmt, <span class="string">"before"</span>, <span class="string">"characters"</span>,</span><br><span class="line">                    Arrays.asList(book.characters));</span><br><span class="line">            <span class="comment">//设置数组的值</span></span><br><span class="line">            <span class="keyword">String</span>[] <span class="keyword">new</span><span class="type">Chars</span> = &#123; <span class="string">"Queen"</span>, <span class="string">"King"</span> &#125;;</span><br><span class="line">            chars.<span class="keyword">set</span>(book, <span class="keyword">new</span><span class="type">Chars</span>);</span><br><span class="line">            out.format(fmt, <span class="string">"after"</span>, <span class="string">"characters"</span>,</span><br><span class="line">                    Arrays.asList(book.characters));</span><br><span class="line">            <span class="comment">//拿到枚举twin的值</span></span><br><span class="line">            Field t = c.getDeclaredField(<span class="string">"twin"</span>);</span><br><span class="line">            out.format(fmt, <span class="string">"before"</span>, <span class="string">"twin"</span>, book.twin);</span><br><span class="line">            <span class="comment">//设置枚举twin的值</span></span><br><span class="line">            t.<span class="keyword">set</span>(book, Tweedle.DUM);</span><br><span class="line">            out.format(fmt, <span class="string">"after"</span>, <span class="string">"twin"</span>, t.<span class="keyword">get</span>(book));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="note warning">注意：通过反射来设置值必须会出现一定的性能开销，因为需要验证访问权限。从运行的角度来看，因为操作是原子操作，就跟代码里面直接修改值是一样的。<br>并且，反射会取消编译时的优化.</div>

<h3 id="操作时的故障"><a href="#操作时的故障" class="headerlink" title="操作时的故障"></a>操作时的故障</h3><ul>
<li>类型转换的异常IllegalArgumentException</li>
</ul>
<p>例如对引用类型Integer设置一个基本类型的值，在非反射情况下，直接设置。编译器会将类型转换（box装箱）为引用类型new Integer(24)，所以类型检查会通过。但是当用反射的时候类型检查只会出现在运行时，所以没有机会进行装箱。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldTrouble</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span> Integer val;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">	FieldTrouble ft = <span class="keyword">new</span> FieldTrouble();</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    Class&lt;?&gt; c = ft.getClass();</span><br><span class="line">	    Field f = c.getDeclaredField(<span class="string">"val"</span>);</span><br><span class="line">  	    f.setInt(ft, <span class="number">42</span>);               <span class="comment">// IllegalArgumentException</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (NoSuchFieldException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line"> 	&#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line"> 	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于这种情况应该使用<code>f.set(ft, new Integer(43))</code>;</p>
<div class="note danger">对于反射的操作，编译器是没有机会装箱的，编译器只会对调用Class.isAssignableFrom()返回true的方法进行装箱</div>

<p>对于上面的例子来说</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Integer.<span class="keyword">class</span>.isAssignableFrom(<span class="keyword">int</span>.<span class="keyword">class</span>) == <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>因此会抛出异常</p>
<blockquote>
<p>但是对于反过来的情况，因为<code>Feild.set(obj,value)</code>会提供拆箱操作，所以是可以执行的</p>
</blockquote>
<ul>
<li>非public的字段抛出的NoSuchFieldException</li>
</ul>
<p>通常是使用 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getField-java.lang.String-" target="_blank" rel="noopener"><code>Class.getField()</code></a>来调用了非public的方法。可以使用<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredFields--" target="_blank" rel="noopener"><code>Class.getDeclaredFields()</code></a>方法</p>
<ul>
<li>修改final字段的异常IllegalAccessException</li>
</ul>
<p>如果访问<code>private</code>或者<code>final</code>字段的话，通常会抛出<code>IllegalAccessException</code>异常</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> FieldAccess &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> b = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String... args) &#123;</span><br><span class="line">        FieldAccess ft = <span class="keyword">new</span> FieldAccess();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">Class</span>&lt;?&gt; c = ft.getClass();</span><br><span class="line">            Field f = c.getDeclaredField(<span class="string">"b"</span>);</span><br><span class="line">            f.setBoolean(ft, <span class="keyword">Boolean</span>.<span class="keyword">FALSE</span>);   <span class="comment">// IllegalAccessException</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面这段代码会报异常<code>IllegalAccessException</code>在类初始化后不允许修改final字段，然而，字段的声明继承于</p>
<p> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/AccessibleObject.html" target="_blank" rel="noopener"><code>AccessibleObject</code></a>，这让<code>final</code>字段的修改称为可能。</p>
<p>在设置值之前调用</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f.setAccessible(true)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用这个方法有些情况是不安全的，有些情况还会使用其原始的值。</p>
<p>只有安全上下文允许操作时，<code>AccessibleObject.setAccessible</code>才会成功。</p>
</blockquote>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><h3 id="获取方法类型信息"><a href="#获取方法类型信息" class="headerlink" title="获取方法类型信息"></a>获取方法类型信息</h3><p>一个方法的声明包括方法名，修饰符，参数，返回值，返回类型。和一个异常的列表，<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Method.html" target="_blank" rel="noopener"><code>java.lang.reflect.Method</code></a>提供了这些信息的读取。</p>
<p>还是一样举个例子说明情况，下面的例子中，列出了如何获取一个类中的方法并且如何取回类中的返回值、参数、和异常类型。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.lang.reflect.<span class="keyword">Type</span>;</span><br><span class="line">import static java.lang.System.<span class="keyword">out</span>;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> MethodSpy &#123;</span><br><span class="line">    private static final String  fmt = <span class="string">"%24s: %s%n"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for the morbidly curious</span></span><br><span class="line">    &lt;<span class="keyword">E</span> extends RuntimeException&gt; void genericThrow() throws <span class="keyword">E</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    public void main(String... <span class="keyword">args</span>) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            <span class="comment">//获取Class实例</span></span><br><span class="line">            <span class="keyword">Class</span>&lt;?&gt; c = <span class="keyword">Class</span>.forName(<span class="keyword">args</span>[0]);</span><br><span class="line">            <span class="comment">//获取所有的方法</span></span><br><span class="line">            Method[] allMethods = c.getDeclaredMethods();</span><br><span class="line">            <span class="comment">//遍历所有方法</span></span><br><span class="line">            <span class="keyword">for</span> (Method <span class="keyword">m</span> : allMethods) &#123;</span><br><span class="line">                <span class="comment">//如果方法名对应的话走下面的代码</span></span><br><span class="line">                <span class="keyword">if</span> (!<span class="keyword">m</span>.getName().equals(<span class="keyword">args</span>[1])) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//输出方法名称</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">out</span>.<span class="keyword">format</span>(<span class="string">"%s%n"</span>, <span class="keyword">m</span>.toGenericString());</span><br><span class="line">                <span class="comment">//输出返回类型</span></span><br><span class="line">                <span class="keyword">out</span>.<span class="keyword">format</span>(fmt, <span class="string">"ReturnType"</span>, <span class="keyword">m</span>.getReturnType());</span><br><span class="line">                <span class="keyword">out</span>.<span class="keyword">format</span>(fmt, <span class="string">"GenericReturnType"</span>, <span class="keyword">m</span>.getGenericReturnType());</span><br><span class="line"></span><br><span class="line">                <span class="keyword">Class</span>&lt;?&gt;[] pType  = <span class="keyword">m</span>.getParameterTypes();</span><br><span class="line">                <span class="keyword">Type</span>[] gpType = <span class="keyword">m</span>.getGenericParameterTypes();</span><br><span class="line">                <span class="keyword">for</span> (int i = 0; i &lt; pType.length; i++) &#123;</span><br><span class="line">                    <span class="comment">//输出参数类型</span></span><br><span class="line">                    <span class="keyword">out</span>.<span class="keyword">format</span>(fmt,<span class="string">"ParameterType"</span>, pType[i]);</span><br><span class="line">                    <span class="keyword">out</span>.<span class="keyword">format</span>(fmt,<span class="string">"GenericParameterType"</span>, gpType[i]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">Class</span>&lt;?&gt;[] xType  = <span class="keyword">m</span>.getExceptionTypes();</span><br><span class="line">                <span class="keyword">Type</span>[] gxType = <span class="keyword">m</span>.getGenericExceptionTypes();</span><br><span class="line">                <span class="keyword">for</span> (int i = 0; i &lt; xType.length; i++) &#123;</span><br><span class="line">                    <span class="comment">//输出异常类型</span></span><br><span class="line">                    <span class="keyword">out</span>.<span class="keyword">format</span>(fmt,<span class="string">"ExceptionType"</span>, xType[i]);</span><br><span class="line">                    <span class="keyword">out</span>.<span class="keyword">format</span>(fmt,<span class="string">"GenericExceptionType"</span>, gxType[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; catch (ClassNotFoundException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们输入</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">methodSpy</span><span class="selector-class">.main</span>("<span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.Class</span>","<span class="selector-tag">getConstructor</span>");</span><br></pre></td></tr></table></figure>
<p>得到结果</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">I:</span> <span class="string">public</span> <span class="string">java.lang.reflect.Constructor&lt;T&gt;</span> <span class="string">java.lang.Class.getConstructor(java.lang.Class&lt;?&gt;...)</span> <span class="string">throws</span> <span class="string">java.lang.NoSuchMethodException,java.lang.SecurityException</span></span><br><span class="line"><span class="attr">I:</span>               <span class="attr">ReturnType:</span> <span class="string">class</span> <span class="string">java.lang.reflect.Constructor</span></span><br><span class="line"><span class="attr">I:</span>        <span class="attr">GenericReturnType:</span> <span class="string">java.lang.reflect.Constructor&lt;T&gt;</span></span><br><span class="line"><span class="attr">I:</span>            <span class="attr">ParameterType:</span> <span class="string">class</span> <span class="string">[Ljava.lang.Class;</span></span><br><span class="line"><span class="attr">I:</span>     <span class="attr">GenericParameterType:</span> <span class="string">java.lang.Class&lt;?&gt;[]</span></span><br><span class="line"><span class="attr">I:</span>            <span class="attr">ExceptionType:</span> <span class="string">class</span> <span class="string">java.lang.NoSuchMethodException</span></span><br><span class="line"><span class="attr">I:</span>     <span class="attr">GenericExceptionType:</span> <span class="string">class</span> <span class="string">java.lang.NoSuchMethodException</span></span><br><span class="line"><span class="attr">I:</span>            <span class="attr">ExceptionType:</span> <span class="string">class</span> <span class="string">java.lang.SecurityException</span></span><br><span class="line"><span class="attr">I:</span>     <span class="attr">GenericExceptionType:</span> <span class="string">class</span> <span class="string">java.lang.SecurityException</span></span><br></pre></td></tr></table></figure>
<p>可以对照一下，我们会拿到Class这个方法的所有类型：</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">Constructor</span>&lt;<span class="title">T</span>&gt; <span class="title">getConstructor</span><span class="params">(<span class="keyword">Class</span>&lt;?&gt;... parameterTypes)</span></span></span><br><span class="line"><span class="function">        <span class="title">throws</span> <span class="title">NoSuchMethodException</span>, <span class="title">SecurityException</span> <span class="comment">&#123;</span></span></span><br><span class="line"><span class="function"><span class="comment">        return getConstructor0(parameterTypes, Member.PUBLIC);</span></span></span><br><span class="line"><span class="function"><span class="comment">    &#125;</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Method.html#getGenericReturnType--" target="_blank" rel="noopener"><code>Method.getGenericReturnType()</code></a> 返回通用的Type（Class文件中的签名属性），如果这个属性不可用，将调用<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Method.html#getReturnType--" target="_blank" rel="noopener"><code>Method.getReturnType()</code></a> 方法。对于获取其他值getGeneric<em>Foo</em>()，这条规则也是通用的。</p>
</blockquote>
<blockquote>
<p>然后看参数是一个数组，并且是一个<code>variable arity</code>,这里我们可以使用<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Method.html#isVarArgs--" target="_blank" rel="noopener"><code>Method.isVarArgs()</code></a>将其与普通的数组区分开来，</p>
</blockquote>
<p>然后我们看下<code>class</code>中的<code>cast</code>方法，执行</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">methodSpy</span><span class="selector-class">.main</span>("<span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.Class</span>","<span class="selector-tag">cast</span>");</span><br></pre></td></tr></table></figure>
<p>得到：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">I: public T java<span class="selector-class">.lang</span><span class="selector-class">.Class</span><span class="selector-class">.cast</span>(java<span class="selector-class">.lang</span><span class="selector-class">.Object</span>)</span><br><span class="line">I:               ReturnType: class java<span class="selector-class">.lang</span><span class="selector-class">.Object</span></span><br><span class="line">I:        GenericReturnType: T</span><br><span class="line">I:            ParameterType: class java<span class="selector-class">.lang</span><span class="selector-class">.Object</span></span><br><span class="line">I:     GenericParameterType: class java<span class="selector-class">.lang</span><span class="selector-class">.Object</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>由于泛型在编译期间会进行类型擦除，因此，T被类型变量的上限Object所取代</p>
</blockquote>
<h3 id="获取方法的名称"><a href="#获取方法的名称" class="headerlink" title="获取方法的名称"></a>获取方法的名称</h3><p>用<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Executable.html#getParameters--" target="_blank" rel="noopener"><code>java.lang.reflect.Executable.getParameters</code></a>可以根据任何方法和构造函数获得形参的名称。因为<code>Method</code>和<code>Constraint</code>都继承了 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Executable.html" target="_blank" rel="noopener"><code>Executable</code></a>并且继承了其<code>getParameters</code>方法。</p>
<p>类文件默认没有存储形参，这是因为大多的工具在生成和消耗类文件的时候不希望大的动态和静态文件包含参数，这会让虚拟机需要更大的内存。而且一些参数可能还包含敏感信息（用户名和密码）。</p>
<p>如果我们想打印出参数的名称，我们首先需要设置虚拟机参数<code>-parameters</code>来允许这样做。</p>
<p>下面我们举个例子来学习：首先我们需要一个ExampleMethods</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> class ExampleMethods&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">boolean</span> simpleMethod(<span class="keyword">String</span> stringParam, <span class="built_in">int</span> intParam) &#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"String: "</span> + stringParam + <span class="string">", integer: "</span> + intParam);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> varArgsMethod(<span class="keyword">String</span>... manyStrings) &#123;</span><br><span class="line">        <span class="keyword">return</span> manyStrings.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">boolean</span> methodWithList(List&lt;<span class="keyword">String</span>&gt; listParam) &#123;</span><br><span class="line">        <span class="keyword">return</span> listParam.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> genericMethod(T[] a, Collection&lt;T&gt; c) &#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"Length of array: "</span> + a.length);</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"Size of collection: "</span> + c.<span class="built_in">size</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们来写出下面一段代码</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">package lab.mon.actlab.java.reflect;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import java.lang.reflect.*;</span><br><span class="line">import java.util.function.*;</span><br><span class="line">import <span class="keyword">static</span> java.lang.System.<span class="keyword">out</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MethodParameterSpy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> final String  fmt = <span class="string">"%24s: %s%n"</span>;</span><br><span class="line"></span><br><span class="line">    &lt;E extends RuntimeException&gt; <span class="function"><span class="keyword">void</span> <span class="title">genericThrow</span>(<span class="params"></span>) throws E</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printClassConstructors</span>(<span class="params">Class c</span>)</span> &#123;</span><br><span class="line">        Constructor[] allConstructors = c.getConstructors();</span><br><span class="line">        <span class="keyword">out</span>.format(fmt, <span class="string">"Number of constructors"</span>, allConstructors.length);</span><br><span class="line">        <span class="keyword">for</span> (Constructor currentConstructor : allConstructors) &#123;</span><br><span class="line">            printConstructor(currentConstructor);</span><br><span class="line">        &#125;</span><br><span class="line">        Constructor[] allDeclConst = c.getDeclaredConstructors();</span><br><span class="line">        <span class="keyword">out</span>.format(fmt, <span class="string">"Number of declared constructors"</span>,</span><br><span class="line">                allDeclConst.length);</span><br><span class="line">        <span class="keyword">for</span> (Constructor currentDeclConst : allDeclConst) &#123;</span><br><span class="line">            printConstructor(currentDeclConst);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printConstructor</span>(<span class="params">Constructor c</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">out</span>.format(<span class="string">"%s%n"</span>, c.toGenericString());</span><br><span class="line">        Parameter[] <span class="keyword">params</span> = c.getParameters();</span><br><span class="line">        <span class="keyword">out</span>.format(fmt, <span class="string">"Number of parameters"</span>, <span class="keyword">params</span>.length);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">params</span>.length; i++) &#123;</span><br><span class="line">            printParameter(<span class="keyword">params</span>[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printClassMethods</span>(<span class="params">Class c</span>)</span> &#123;</span><br><span class="line">        <span class="comment">//获取类的所有方法</span></span><br><span class="line">        Method[] allMethods = c.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">out</span>.format(fmt, <span class="string">"Number of methods"</span>, allMethods.length);</span><br><span class="line">        <span class="keyword">for</span> (Method m : allMethods) &#123;</span><br><span class="line">            <span class="comment">//答应类的方法</span></span><br><span class="line">            printMethod(m);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printMethod</span>(<span class="params">Method m</span>)</span> &#123;</span><br><span class="line">        <span class="comment">//打印方法名称</span></span><br><span class="line">        <span class="keyword">out</span>.format(<span class="string">"%s%n"</span>, m.toGenericString());</span><br><span class="line">        <span class="comment">//打印返回类型</span></span><br><span class="line">        <span class="keyword">out</span>.format(fmt, <span class="string">"Return type"</span>, m.getReturnType());</span><br><span class="line">        <span class="comment">//打印返回类型</span></span><br><span class="line">        <span class="keyword">out</span>.format(fmt, <span class="string">"Generic return type"</span>, m.getGenericReturnType());</span><br><span class="line"></span><br><span class="line">        Parameter[] <span class="keyword">params</span> = m.getParameters();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">params</span>.length; i++) &#123;</span><br><span class="line">            <span class="comment">//打印参数。</span></span><br><span class="line">            printParameter(<span class="keyword">params</span>[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printParameter</span>(<span class="params">Parameter p</span>)</span> &#123;</span><br><span class="line">        <span class="comment">//获取参数类型。</span></span><br><span class="line">        <span class="keyword">out</span>.format(fmt, <span class="string">"Parameter class"</span>, p.getType());</span><br><span class="line">        <span class="comment">//获取参数名称</span></span><br><span class="line">        <span class="keyword">out</span>.format(fmt, <span class="string">"Parameter name"</span>, p.getName());</span><br><span class="line">        <span class="comment">//获取参数的修饰符</span></span><br><span class="line">        <span class="keyword">out</span>.format(fmt, <span class="string">"Modifiers"</span>, p.getModifiers());</span><br><span class="line">        <span class="comment">//是否是隐式参数</span></span><br><span class="line">        <span class="keyword">out</span>.format(fmt, <span class="string">"Is implicit?"</span>, p.isImplicit());</span><br><span class="line">        <span class="comment">//是否能拿到名字</span></span><br><span class="line">        <span class="keyword">out</span>.format(fmt, <span class="string">"Is name present?"</span>, p.isNamePresent());</span><br><span class="line">        <span class="comment">//是否是合成参数</span></span><br><span class="line">        <span class="keyword">out</span>.format(fmt, <span class="string">"Is synthetic?"</span>, p.isSynthetic());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String... args</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//打印构造函数信息</span></span><br><span class="line">            printClassConstructors(Class.forName(args[<span class="number">0</span>]));</span><br><span class="line">            <span class="comment">//打印类的方法</span></span><br><span class="line">            printClassMethods(Class.forName(args[<span class="number">0</span>]));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后我们看打印</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">I/System.<span class="keyword">out</span>:        <span class="keyword">Number</span> of methods: <span class="number">5</span></span><br><span class="line">I/System.<span class="keyword">out</span>: <span class="keyword">public</span> static java.lang.Object lab.mon.actlab.java.reflect.ExampleMethods.<span class="keyword">access</span>$super(lab.mon.actlab.java.reflect.ExampleMethods,java.lang.String,java.lang.Object...)</span><br><span class="line">I/System.<span class="keyword">out</span>:              <span class="keyword">Return</span> <span class="keyword">type</span>: <span class="keyword">class</span> java.lang.Object</span><br><span class="line">I/System.<span class="keyword">out</span>:      <span class="keyword">Generic</span> <span class="keyword">return</span> <span class="keyword">type</span>: <span class="keyword">class</span> java.lang.Object</span><br><span class="line">I/System.<span class="keyword">out</span>:          <span class="keyword">Parameter</span> <span class="keyword">class</span>: <span class="keyword">class</span> lab.mon.actlab.java.reflect.ExampleMethods</span><br><span class="line">I/System.<span class="keyword">out</span>:           <span class="keyword">Parameter</span> <span class="keyword">name</span>: arg0</span><br><span class="line">I/System.<span class="keyword">out</span>:                Modifiers: <span class="number">0</span></span><br><span class="line">I/System.<span class="keyword">out</span>:             Is <span class="keyword">implicit</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:         Is <span class="keyword">name</span> <span class="built_in">present</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:            Is synthetic?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:          <span class="keyword">Parameter</span> <span class="keyword">class</span>: <span class="keyword">class</span> java.lang.String</span><br><span class="line">I/System.<span class="keyword">out</span>:           <span class="keyword">Parameter</span> <span class="keyword">name</span>: arg1</span><br><span class="line">I/System.<span class="keyword">out</span>:                Modifiers: <span class="number">0</span></span><br><span class="line">I/System.<span class="keyword">out</span>:             Is <span class="keyword">implicit</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:         Is <span class="keyword">name</span> <span class="built_in">present</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:            Is synthetic?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:          <span class="keyword">Parameter</span> <span class="keyword">class</span>: <span class="keyword">class</span> [Ljava.lang.Object;</span><br><span class="line">I/System.<span class="keyword">out</span>:           <span class="keyword">Parameter</span> <span class="keyword">name</span>: arg2</span><br><span class="line">I/System.<span class="keyword">out</span>:                Modifiers: <span class="number">0</span></span><br><span class="line">I/System.<span class="keyword">out</span>:             Is <span class="keyword">implicit</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:         Is <span class="keyword">name</span> <span class="built_in">present</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:            Is synthetic?: false</span><br><span class="line">I/System.<span class="keyword">out</span>: <span class="keyword">public</span> &lt;T&gt; void lab.mon.actlab.java.reflect.ExampleMethods.genericMethod(T[],java.util.Collection&lt;T&gt;)</span><br><span class="line">I/System.<span class="keyword">out</span>:              <span class="keyword">Return</span> <span class="keyword">type</span>: void</span><br><span class="line">I/System.<span class="keyword">out</span>:      <span class="keyword">Generic</span> <span class="keyword">return</span> <span class="keyword">type</span>: void</span><br><span class="line">I/System.<span class="keyword">out</span>:          <span class="keyword">Parameter</span> <span class="keyword">class</span>: <span class="keyword">class</span> [Ljava.lang.Object;</span><br><span class="line">I/System.<span class="keyword">out</span>:           <span class="keyword">Parameter</span> <span class="keyword">name</span>: arg0</span><br><span class="line">I/System.<span class="keyword">out</span>:                Modifiers: <span class="number">0</span></span><br><span class="line">I/System.<span class="keyword">out</span>:             Is <span class="keyword">implicit</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:         Is <span class="keyword">name</span> <span class="built_in">present</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:            Is synthetic?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:          <span class="keyword">Parameter</span> <span class="keyword">class</span>: <span class="keyword">interface</span> java.util.Collection</span><br><span class="line">I/System.<span class="keyword">out</span>:           <span class="keyword">Parameter</span> <span class="keyword">name</span>: arg1</span><br><span class="line">I/System.<span class="keyword">out</span>:                Modifiers: <span class="number">0</span></span><br><span class="line">I/System.<span class="keyword">out</span>:             Is <span class="keyword">implicit</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:         Is <span class="keyword">name</span> <span class="built_in">present</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:            Is synthetic?: false</span><br><span class="line">I/System.<span class="keyword">out</span>: <span class="keyword">public</span> boolean lab.mon.actlab.java.reflect.ExampleMethods.methodWithList(java.util.List&lt;java.lang.String&gt;)</span><br><span class="line">I/System.<span class="keyword">out</span>:              <span class="keyword">Return</span> <span class="keyword">type</span>: boolean</span><br><span class="line">I/System.<span class="keyword">out</span>:      <span class="keyword">Generic</span> <span class="keyword">return</span> <span class="keyword">type</span>: boolean</span><br><span class="line">I/System.<span class="keyword">out</span>:          <span class="keyword">Parameter</span> <span class="keyword">class</span>: <span class="keyword">interface</span> java.util.List</span><br><span class="line">I/System.<span class="keyword">out</span>:           <span class="keyword">Parameter</span> <span class="keyword">name</span>: arg0</span><br><span class="line">I/System.<span class="keyword">out</span>:                Modifiers: <span class="number">0</span></span><br><span class="line">I/System.<span class="keyword">out</span>:             Is <span class="keyword">implicit</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:         Is <span class="keyword">name</span> <span class="built_in">present</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:            Is synthetic?: false</span><br><span class="line">I/System.<span class="keyword">out</span>: <span class="keyword">public</span> boolean lab.mon.actlab.java.reflect.ExampleMethods.simpleMethod(java.lang.String,<span class="built_in">int</span>)</span><br><span class="line">I/System.<span class="keyword">out</span>:              <span class="keyword">Return</span> <span class="keyword">type</span>: boolean</span><br><span class="line">I/System.<span class="keyword">out</span>:      <span class="keyword">Generic</span> <span class="keyword">return</span> <span class="keyword">type</span>: boolean</span><br><span class="line">I/System.<span class="keyword">out</span>:          <span class="keyword">Parameter</span> <span class="keyword">class</span>: <span class="keyword">class</span> java.lang.String</span><br><span class="line">I/System.<span class="keyword">out</span>:           <span class="keyword">Parameter</span> <span class="keyword">name</span>: arg0</span><br><span class="line">I/System.<span class="keyword">out</span>:                Modifiers: <span class="number">0</span></span><br><span class="line">I/System.<span class="keyword">out</span>:             Is <span class="keyword">implicit</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:         Is <span class="keyword">name</span> <span class="built_in">present</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:            Is synthetic?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:          <span class="keyword">Parameter</span> <span class="keyword">class</span>: <span class="built_in">int</span></span><br><span class="line">I/System.<span class="keyword">out</span>:           <span class="keyword">Parameter</span> <span class="keyword">name</span>: arg1</span><br><span class="line">I/System.<span class="keyword">out</span>:                Modifiers: <span class="number">0</span></span><br><span class="line">I/System.<span class="keyword">out</span>:             Is <span class="keyword">implicit</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:         Is <span class="keyword">name</span> <span class="built_in">present</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:            Is synthetic?: false</span><br><span class="line">I/System.<span class="keyword">out</span>: <span class="keyword">public</span> <span class="built_in">int</span> lab.mon.actlab.java.reflect.ExampleMethods.varArgsMethod(java.lang.String...)</span><br><span class="line">I/System.<span class="keyword">out</span>:              <span class="keyword">Return</span> <span class="keyword">type</span>: <span class="built_in">int</span></span><br><span class="line">I/System.<span class="keyword">out</span>:      <span class="keyword">Generic</span> <span class="keyword">return</span> <span class="keyword">type</span>: <span class="built_in">int</span></span><br><span class="line">I/System.<span class="keyword">out</span>:          <span class="keyword">Parameter</span> <span class="keyword">class</span>: <span class="keyword">class</span> [Ljava.lang.String;</span><br><span class="line">I/System.<span class="keyword">out</span>:           <span class="keyword">Parameter</span> <span class="keyword">name</span>: arg0</span><br><span class="line">I/System.<span class="keyword">out</span>:                Modifiers: <span class="number">0</span></span><br><span class="line">I/System.<span class="keyword">out</span>:             Is <span class="keyword">implicit</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:         Is <span class="keyword">name</span> <span class="built_in">present</span>?: false</span><br><span class="line">I/System.<span class="keyword">out</span>:            Is synthetic?: false</span><br></pre></td></tr></table></figure>
<p>日志比较长，但是从中我们可以看到有5个方法，另外方法里面的参数都是什么</p>
<p>首先先看我们使用<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Parameter.html" target="_blank" rel="noopener"><code>Parameter</code></a>里面的方法：</p>
<ul>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Parameter.html#getType--" target="_blank" rel="noopener"><code>getType</code></a>：返回一个对象，表明这个参数的类型</li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Parameter.html#getName--" target="_blank" rel="noopener"><code>getName</code></a>：返回参数的名称，如果参数存在，则返回.class提供的名称，其他情况下，将返回argN，这个N是第几个参数的意思</li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Parameter.html#getModifiers--" target="_blank" rel="noopener"><code>getModifiers</code></a>返回一个整数，表明参数所拥有的各种特征。遵循以下表格，存在多个就求和</li>
</ul>
<ul>
<li><p>| decimal | hexadecimal | 描述               |<br>| ——- | ———– | —————— |<br>| 16      | 0x0010      | 形参声明为 <code>final</code> |<br>| 4096    | 0x1000      | 表明形参是合成的   |<br>| 32768   | 0x8000      | 表明形参是隐式参数 |</p>
</li>
<li><p><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Parameter.html#isImplicit--" target="_blank" rel="noopener"><code>isImplicit</code></a>: 如果是隐士的则返回<code>true</code></p>
</li>
<li><p><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Parameter.html#isNamePresent--" target="_blank" rel="noopener"><code>isNamePresent</code></a>: 如果参数在<code>.class</code>文件中有名字的话就返回<code>true</code>。</p>
</li>
<li><p><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Parameter.html#isSynthetic--" target="_blank" rel="noopener"><code>isSynthetic</code></a>: 如果在代码中没有显示或隐士的显示参数则返回<code>true</code></p>
</li>
</ul>
<h4 id="隐式和合成参数"><a href="#隐式和合成参数" class="headerlink" title="隐式和合成参数"></a>隐式和合成参数</h4><ul>
<li>隐式参数</li>
</ul>
<p>有些构造体没有写在代码中的话会隐士的声明，</p>
<p>例如：咱们的例子中没有构造函数，但是有一个默认的构造函数隐式的声明了。</p>
<p>再例如：假设这么一种情况：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodParameterExamples</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span> </span>&#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>InnerClass</code>是一个嵌套类或者说内部类，其构造函数也是隐式的，但是！这个构造函数是有个参数的，当Java编译器编译的时候会大概出现以下代码。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodParameterExamples</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> MethodParameterExamples parent;</span><br><span class="line">        InnerClass(<span class="keyword">final</span> MethodParameterExamples <span class="keyword">this</span>$<span class="number">0</span>) &#123;</span><br><span class="line">            parent = <span class="keyword">this</span>$<span class="number">0</span>; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们用刚才的例子打印出结果将是这样的</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> MethodParameterExamples$InnerClass(MethodParameterExamples)</span><br><span class="line">         <span class="keyword">Parameter</span> <span class="keyword">class</span>: <span class="keyword">class</span> MethodParameterExamples</span><br><span class="line">          <span class="keyword">Parameter</span> <span class="keyword">name</span>: this$<span class="number">0</span></span><br><span class="line">               Modifiers: <span class="number">32784</span></span><br><span class="line">            Is <span class="keyword">implicit</span>?: true</span><br><span class="line">        Is <span class="keyword">name</span> <span class="built_in">present</span>?: true</span><br><span class="line">           Is synthetic?: false</span><br></pre></td></tr></table></figure>
<blockquote>
<p>23786标识是final和隐式的</p>
</blockquote>
<ul>
<li>合成参数</li>
</ul>
<p>除非是类的初始化方法，如果参数不对应显示或隐式的构造声明的话，那么标记为合成(synthetic)的。合成构造是</p>
<p>考虑到一下枚举：</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MethodParameterExamples</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Colors</span> &#123;</span></span><br><span class="line">        RED, WHITE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译器在编译期会将枚举拆成几个方法，并提供枚举的基本功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Colors</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Enum</span>&lt;<span class="title">Colors</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> Colors RED = <span class="keyword">new</span> Colors(<span class="string">"RED"</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> Colors BLUE = <span class="keyword">new</span> Colors(<span class="string">"WHITE"</span>, <span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> values = <span class="keyword">new</span> Colors[]&#123; RED, BLUE &#125;;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Colors</span><span class="params">(String name, <span class="keyword">int</span> ordinal)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name, ordinal);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Colors[] values()&#123;</span><br><span class="line">        <span class="keyword">return</span> values;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Colors <span class="title">valueOf</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Colors)java.lang.Enum.valueOf(Colors.class, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译器在编译期会生成这些<code>Colors(String name, int ordinal)</code>, <code>Colors[] values()</code>, 和 <code>Colors valueOf(String name)</code>方法，他们都是隐式声明的，同样的形参也是隐式声明的。</p>
<p>这个构造方法是隐式声明的，但是这个构造方法的行参不是隐式声明的！为什么呢？因为不同的编译器不需要在此构造函数的形式上达成一致，在另一个编译器中可能是另一种声明，所以不是隐式的。</p>
<p>既不是隐式的参数（参数不固定），又不是显式的参数（在隐式方法中），那么就是合成参数了。。</p>
<p>用刚才的MethodParameterExample例子跑一下得到输出：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> Colors:</span><br><span class="line"></span><br><span class="line"><span class="keyword">Number</span> of constructors: <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Number</span> of declared constructors: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">Declared constructor #<span class="number">1</span></span><br><span class="line"><span class="keyword">private</span> MethodParameterExamples$Colors()</span><br><span class="line">         <span class="keyword">Parameter</span> <span class="keyword">class</span>: <span class="keyword">class</span> java.lang.String</span><br><span class="line">          <span class="keyword">Parameter</span> <span class="keyword">name</span>: $<span class="keyword">enum</span>$<span class="keyword">name</span></span><br><span class="line">               Modifiers: <span class="number">4096</span></span><br><span class="line">            Is <span class="keyword">implicit</span>?: false</span><br><span class="line">        Is <span class="keyword">name</span> <span class="built_in">present</span>?: true</span><br><span class="line">           Is synthetic?: true</span><br><span class="line">         <span class="keyword">Parameter</span> <span class="keyword">class</span>: <span class="built_in">int</span></span><br><span class="line">          <span class="keyword">Parameter</span> <span class="keyword">name</span>: $<span class="keyword">enum</span>$ordinal</span><br><span class="line">               Modifiers: <span class="number">4096</span></span><br><span class="line">            Is <span class="keyword">implicit</span>?: false</span><br><span class="line">        Is <span class="keyword">name</span> <span class="built_in">present</span>?: true</span><br><span class="line">           Is synthetic?: true</span><br><span class="line"></span><br><span class="line"><span class="keyword">Number</span> of methods: <span class="number">2</span></span><br><span class="line"></span><br><span class="line">Method #<span class="number">1</span></span><br><span class="line"><span class="keyword">public</span> static MethodParameterExamples$Colors[]</span><br><span class="line">    MethodParameterExamples$Colors.values()</span><br><span class="line">             <span class="keyword">Return</span> <span class="keyword">type</span>: <span class="keyword">class</span> [LMethodParameterExamples$Colors;</span><br><span class="line">     <span class="keyword">Generic</span> <span class="keyword">return</span> <span class="keyword">type</span>: <span class="keyword">class</span> [LMethodParameterExamples$Colors;</span><br><span class="line"></span><br><span class="line">Method #<span class="number">2</span></span><br><span class="line"><span class="keyword">public</span> static MethodParameterExamples$Colors</span><br><span class="line">    MethodParameterExamples$Colors.valueOf(java.lang.String)</span><br><span class="line">             <span class="keyword">Return</span> <span class="keyword">type</span>: <span class="keyword">class</span> MethodParameterExamples$Colors</span><br><span class="line">     <span class="keyword">Generic</span> <span class="keyword">return</span> <span class="keyword">type</span>: <span class="keyword">class</span> MethodParameterExamples$Colors</span><br><span class="line">         <span class="keyword">Parameter</span> <span class="keyword">class</span>: <span class="keyword">class</span> java.lang.String</span><br><span class="line">          <span class="keyword">Parameter</span> <span class="keyword">name</span>: <span class="keyword">name</span></span><br><span class="line">               Modifiers: <span class="number">32768</span></span><br><span class="line">            Is <span class="keyword">implicit</span>?: true</span><br><span class="line">        Is <span class="keyword">name</span> <span class="built_in">present</span>?: true</span><br><span class="line">           Is synthetic?: false</span><br></pre></td></tr></table></figure>
<h3 id="检索或解析方法的修饰符"><a href="#检索或解析方法的修饰符" class="headerlink" title="检索或解析方法的修饰符"></a>检索或解析方法的修饰符</h3><p>举个例子</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.lang.reflect.Modifier;</span><br><span class="line">import <span class="keyword">static</span> java.lang.System.<span class="keyword">out</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MethodModifierSpy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> count;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> synchronized <span class="keyword">void</span> <span class="title">inc</span>(<span class="params"></span>)</span> &#123; count++; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> synchronized <span class="keyword">int</span> <span class="title">cnt</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> count; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String... args</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">            Method[] allMethods = c.getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span> (Method m : allMethods) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!m.getName().<span class="keyword">equals</span>(args[<span class="number">1</span>])) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">out</span>.format(<span class="string">"%s%n"</span>, m.toGenericString());</span><br><span class="line">                <span class="keyword">out</span>.format(<span class="string">"  Modifiers:  %s%n"</span>, Modifier.toString(m.getModifiers()));</span><br><span class="line">                <span class="keyword">out</span>.format(<span class="string">"  [ synthetic=%-5b var_args=%-5b bridge=%-5b ]%n"</span>, m.isSynthetic(), m.isVarArgs(), m.isBridge());</span><br><span class="line">                inc();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">out</span>.format(<span class="string">"%d matching overload%s found%n"</span>, cnt(), (cnt() == <span class="number">1</span> ? <span class="string">""</span> : <span class="string">"s"</span>));</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">methodModifierSpy</span><span class="selector-class">.main</span>("<span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.String</span>","<span class="selector-tag">compareTo</span>");</span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> java.lang.<span class="keyword">String</span>.compareTo(java.lang.<span class="keyword">String</span>)</span><br><span class="line">  Modifiers: <span class="keyword">public</span></span><br><span class="line">  [ synthetic=<span class="keyword">false</span> var_args=<span class="keyword">false</span> bridge=<span class="keyword">false</span> ]</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> java.lang.<span class="keyword">String</span>.compareTo(java.lang.<span class="keyword">Object</span>)</span><br><span class="line">  Modifiers: <span class="keyword">public</span> <span class="keyword">volatile</span></span><br><span class="line">  [ synthetic=<span class="keyword">true</span>  var_args=<span class="keyword">false</span> bridge=<span class="keyword">true</span>  ]</span><br><span class="line"><span class="number">2</span> matching overloads found</span><br></pre></td></tr></table></figure>
<p>这里为什么又两个呢？</p>
<p>第二个<em>synthetic</em>或者说编译期生成的<em>bridge</em>方法，是因为String继承了参数化的接口<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Comparable.html" target="_blank" rel="noopener"><code>Comparable</code></a>，当执行类型擦除的时候，从<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Comparable.html#compareTo-T-" target="_blank" rel="noopener"><code>Comparable.compareTo()</code></a> 继承的方法类型从<code>Object</code>变为<code>String</code>，当Comparable和String的参数类型在类型擦除后不再匹配，就不用重写了，bridge方法避免了重写的问题。</p>
<h3 id="调用方法"><a href="#调用方法" class="headerlink" title="调用方法"></a>调用方法</h3><p>反射提供了调用方法的方法。在非反射代码中，如果无法将类的实例转换为需要的类型，那么将执行<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Method.html#invoke-java.lang.Object-java.lang.Object...-" target="_blank" rel="noopener"><code>java.lang.reflect.Method.invoke()</code></a>，第一个参数是调用特定方法的实例（方法是静态的话可以为空），接下来的就是传入方法的参数，如果出现异常则会抛出<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/InvocationTargetException.html" target="_blank" rel="noopener"><code>java.lang.reflect.InvocationTargetException</code></a>，但是如果想获得原始的异常可以使用<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/InvocationTargetException.html#getCause--" target="_blank" rel="noopener"><code>InvocationTargetException.getCause()</code></a>方法。</p>
<h4 id="调用普通方法"><a href="#调用普通方法" class="headerlink" title="调用普通方法"></a>调用普通方法</h4><p>举例说明：首先创建一个类</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> static java.lang.System.<span class="keyword">out</span>;</span><br><span class="line"><span class="keyword">import</span> static java.lang.System.err;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Deet</span>&lt;<span class="type">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> boolean testDeet(Locale l) &#123;</span><br><span class="line">        <span class="comment">// getISO3Language() may throw a MissingResourceException</span></span><br><span class="line">        <span class="keyword">out</span>.format(<span class="string">"Locale = %s, ISO Language Code = %s%n"</span>, l.getDisplayName(), l.getISO3Language());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> int testFoo(Locale l) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> boolean testBar() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> void main(String... args) &#123;</span><br><span class="line">        <span class="keyword">if</span> (args.length != <span class="number">4</span>) &#123;</span><br><span class="line">            err.format(<span class="string">"Usage: java Deet &lt;classname&gt; &lt;langauge&gt; &lt;country&gt; &lt;variant&gt;%n"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取类的class</span></span><br><span class="line">            Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="comment">//创建类的实例</span></span><br><span class="line">            Object t = c.newInstance();</span><br><span class="line">            <span class="comment">//获取所有的方法</span></span><br><span class="line">            Method[] allMethods = c.getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span> (Method m : allMethods) &#123;</span><br><span class="line">                <span class="comment">//获取方法名称</span></span><br><span class="line">                String mname = m.getName();</span><br><span class="line">                <span class="comment">//如果不是以test开头或者返回类型不是boolean的话就跳出循环</span></span><br><span class="line">                <span class="keyword">if</span> (!mname.startsWith(<span class="string">"test"</span>) || (m.getGenericReturnType() != boolean.<span class="keyword">class</span>)) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//获取所有的参数</span></span><br><span class="line">                Type[] pType = m.getGenericParameterTypes();</span><br><span class="line">                <span class="comment">//如果方法参数不是1或者不允许访问的话跳出</span></span><br><span class="line">                <span class="keyword">if</span> ((pType.length != <span class="number">1</span>) || Locale.<span class="keyword">class</span>.isAssignableFrom(pType[<span class="number">0</span>].getClass())) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">out</span>.format(<span class="string">"invoking %s()%n"</span>, mname);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//获取访问权限</span></span><br><span class="line">                    m.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                    <span class="comment">//调用方法并得到返回值</span></span><br><span class="line">                    Object o = m.invoke(t, new Locale(args[<span class="number">1</span>], args[<span class="number">2</span>], args[<span class="number">3</span>]));</span><br><span class="line">                    <span class="keyword">out</span>.format(<span class="string">"%s() returned %b%n"</span>, mname, (<span class="built_in">Boolean</span>) o);</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InvocationTargetException x) &#123;</span><br><span class="line">                    Throwable cause = x.getCause();</span><br><span class="line">                    err.format(<span class="string">"invocation of %s failed: %s%n"</span>,</span><br><span class="line">                            mname, cause.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后执行：</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Deet deet = <span class="keyword">new</span> Deet();</span><br><span class="line">deet.main(Deet.<span class="keyword">class</span>.getCanonicalName(),<span class="string">"ja"</span>, <span class="string">"JP"</span>, <span class="string">"JP"</span>);</span><br></pre></td></tr></table></figure>
<p>最后得到</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">I/System<span class="selector-class">.out</span>: invoking testDeet()</span><br><span class="line">I/System<span class="selector-class">.out</span>: Locale = Japanese (Japan,JP), ISO Language Code = jpn</span><br><span class="line">I/System<span class="selector-class">.out</span>: testDeet() returned true</span><br></pre></td></tr></table></figure>
<p>其中，<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#isAssignableFrom-java.lang.Class-" target="_blank" rel="noopener"><code>Class.isAssignableFrom()</code></a>来判断Located方法是否可以调用，从代码上来说<code>Locale.class == pType[0].getClass()</code>为<code>true</code>的话可以判断<code>Locale</code>是否为<code>final</code></p>
<h4 id="调用可变数量的参数"><a href="#调用可变数量的参数" class="headerlink" title="调用可变数量的参数"></a>调用可变数量的参数</h4><p>举例说明：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> InvokeMain &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String... args) &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    <span class="keyword">Class</span>&lt;?&gt; c = <span class="keyword">Class</span>.forName(args[<span class="number">0</span>]);</span><br><span class="line">	    <span class="keyword">Class</span>[] argTypes = <span class="keyword">new</span> <span class="keyword">Class</span>[] &#123; String[].<span class="keyword">class</span> &#125;;</span><br><span class="line">	    Method main = c.getDeclaredMethod(<span class="string">"main"</span>, argTypes);</span><br><span class="line">  	    String[] mainArgs = Arrays.copyOfRange(args, <span class="number">1</span>, args.length);</span><br><span class="line">	    System.out.format(<span class="string">"invoking %s.main()%n"</span>, c.getName());</span><br><span class="line">	    main.invoke(<span class="keyword">null</span>, (Object)mainArgs);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (NoSuchMethodException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (InvocationTargetException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法的异常"><a href="#方法的异常" class="headerlink" title="方法的异常"></a>方法的异常</h3><h4 id="NoSuchMethodException"><a href="#NoSuchMethodException" class="headerlink" title="NoSuchMethodException"></a>NoSuchMethodException</h4><p>例子：未考虑对象擦著</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodTrouble</span>&lt;T&gt;  &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lookup</span><span class="params">(T t)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">find</span><span class="params">(Integer i)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    String mName = args[<span class="number">0</span>];</span><br><span class="line">	    Class cArg = Class.forName(args[<span class="number">1</span>]);</span><br><span class="line">	    Class&lt;?&gt; c = (<span class="keyword">new</span> MethodTrouble&lt;Integer&gt;()).getClass();</span><br><span class="line">	    Method m = c.getMethod(mName, cArg);</span><br><span class="line">	    System.out.format(<span class="string">"Found:%n  %s%n"</span>, m.toGenericString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (NoSuchMethodException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原方法：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> MethodTrouble.lookup(T)</span><br></pre></td></tr></table></figure>
<p>当使用泛型参数类型声明方法时，编译器将使用其上限替换泛型类型，在这种情况下，T的上限是Object，所以当代码搜索lookup（Integer）时，找不到任何方法。</p>
<h4 id="IllegalAccessException"><a href="#IllegalAccessException" class="headerlink" title="IllegalAccessException"></a>IllegalAccessException</h4><p>如果尝试调用私有或其他不可访问的方法，则抛出IllegalAccessException。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">import</span> java.lang.reflect.InvocationTargetException;</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">import</span> java.lang.reflect.Method;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnotherClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> m() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodTroubleAgain</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String... args) &#123;</span><br><span class="line">	AnotherClass ac = <span class="keyword">new</span> AnotherClass();</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    Class&lt;?&gt; c = ac.getClass();</span><br><span class="line"> 	    Method m = c.getDeclaredMethod(<span class="string">"m"</span>);</span><br><span class="line"><span class="comment">//  	    m.setAccessible(true);      // 解决方案</span></span><br><span class="line"> 	    Object o = m.invoke(ac);    <span class="comment">// IllegalAccessException</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (NoSuchMethodException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (InvocationTargetException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和字段一样不做多的描述。</p>
<h4 id="IllegalArgumentException"><a href="#IllegalArgumentException" class="headerlink" title="IllegalArgumentException"></a>IllegalArgumentException</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> MethodTroubleToo &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> ping() &#123; System.out.format(<span class="string">"PONG!%n"</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> main(<span class="built_in">String</span>... args) &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    MethodTroubleToo mtt = <span class="keyword">new</span> MethodTroubleToo();</span><br><span class="line">	    Method m = MethodTroubleToo.class.getMethod(<span class="string">"ping"</span>);</span><br><span class="line"></span><br><span class="line"> 	    <span class="keyword">switch</span>(Integer.parseInt(args[<span class="number">0</span>])) &#123;</span><br><span class="line">	    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">  		m.invoke(mtt);                </span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line"> 		m.invoke(mtt, <span class="literal">null</span>);           </span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">		<span class="built_in">Object</span> arg2 = <span class="literal">null</span>;</span><br><span class="line">		m.invoke(mtt, arg2);           <span class="comment">// IllegalArgumentException</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">		m.invoke(mtt, <span class="keyword">new</span> <span class="built_in">Object</span>[<span class="number">0</span>]);  </span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">		<span class="built_in">Object</span> arg4 = <span class="keyword">new</span> <span class="built_in">Object</span>[<span class="number">0</span>];</span><br><span class="line">		m.invoke(mtt, arg4);           <span class="comment">// IllegalArgumentException</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	    <span class="keyword">default</span>:</span><br><span class="line">		System.out.format(<span class="string">"Test not found%n"</span>);</span><br><span class="line">	    &#125;</span><br><span class="line"></span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分别执行方法1、2、3、4</p>
<ul>
<li>1不报异常，因为这个方法没有参数</li>
<li>2报异常，因为2相当于传递了一个空的参数是找不到这个方法的</li>
<li>3不报异常，因为可以理解为传递了一个可变的参数</li>
<li>4报异常，原因和2一样，也是传递了一个参数，方法是找不到这个的</li>
</ul>
<h2 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h2><p>构造函数用来创建一个对象的实例，通常下，在执行一个类的方法调用之前会执行初始化操作这就是构造函数。</p>
<p>下面我们来举例说明构造函数</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> ConstructorSift &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> main(String... args) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">Class</span>&lt;?&gt; cArg = <span class="keyword">Class</span>.forName(args[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">Class</span>&lt;?&gt; c = <span class="keyword">Class</span>.forName(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="comment">//获取类的构造函数</span></span><br><span class="line">            Constructor[] allConstructors = c.getDeclaredConstructors();</span><br><span class="line">            <span class="comment">//遍历构造函数</span></span><br><span class="line">            <span class="keyword">for</span> (Constructor ctor : allConstructors) &#123;</span><br><span class="line">                <span class="comment">//获取构造函数的参数</span></span><br><span class="line">                <span class="keyword">Class</span>&lt;?&gt;[] pType = ctor.getParameterTypes();</span><br><span class="line">                <span class="comment">//构造函数的参数</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pType.length; i++) &#123;</span><br><span class="line">                    <span class="comment">//如果构造函数的参数包含了传递过来的参数</span></span><br><span class="line">                    <span class="keyword">if</span> (pType[i].equals(cArg)) &#123;</span><br><span class="line">                        <span class="comment">//输出构造函数</span></span><br><span class="line">                        out.format(<span class="string">"%s%n"</span>, ctor.toGenericString());</span><br><span class="line">                        <span class="comment">//获取构造函数的参数</span></span><br><span class="line">                        Type[] gpType = ctor.getGenericParameterTypes();</span><br><span class="line">                        <span class="comment">//遍历参数</span></span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; gpType.length; j++) &#123;</span><br><span class="line">                            <span class="keyword">char</span> ch = (pType[j].equals(cArg) ? <span class="string">'*'</span> : <span class="string">' '</span>);</span><br><span class="line">                            <span class="comment">//输出</span></span><br><span class="line">                            out.format(<span class="string">"%7c%s[%d]: %s%n"</span>, ch, <span class="string">"GenericParameterType"</span>, j, gpType[j]);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输入</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">constructorSift</span><span class="selector-class">.main</span>("<span class="selector-tag">java</span><span class="selector-class">.util</span><span class="selector-class">.Formatter</span>", "<span class="selector-tag">java</span><span class="selector-class">.util</span><span class="selector-class">.Locale</span>");</span><br></pre></td></tr></table></figure>
<p>得到输出</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">I/System<span class="selector-class">.out</span>: public java<span class="selector-class">.util</span><span class="selector-class">.Formatter</span>(java<span class="selector-class">.io</span><span class="selector-class">.File</span>,java<span class="selector-class">.lang</span><span class="selector-class">.String</span>,java<span class="selector-class">.util</span><span class="selector-class">.Locale</span>) throws java<span class="selector-class">.io</span><span class="selector-class">.FileNotFoundException</span>,java<span class="selector-class">.io</span><span class="selector-class">.UnsupportedEncodingException</span></span><br><span class="line">I/System<span class="selector-class">.out</span>:        GenericParameterType[<span class="number">0</span>]: class java<span class="selector-class">.io</span><span class="selector-class">.File</span></span><br><span class="line">I/System<span class="selector-class">.out</span>:        GenericParameterType[<span class="number">1</span>]: class java<span class="selector-class">.lang</span><span class="selector-class">.String</span></span><br><span class="line">I/System<span class="selector-class">.out</span>:       *GenericParameterType[<span class="number">2</span>]: class java<span class="selector-class">.util</span><span class="selector-class">.Locale</span></span><br><span class="line">I/System<span class="selector-class">.out</span>: public java<span class="selector-class">.util</span><span class="selector-class">.Formatter</span>(java<span class="selector-class">.io</span><span class="selector-class">.OutputStream</span>,java<span class="selector-class">.lang</span><span class="selector-class">.String</span>,java<span class="selector-class">.util</span><span class="selector-class">.Locale</span>) throws java<span class="selector-class">.io</span><span class="selector-class">.UnsupportedEncodingException</span></span><br><span class="line">I/System<span class="selector-class">.out</span>:        GenericParameterType[<span class="number">0</span>]: class java<span class="selector-class">.io</span><span class="selector-class">.OutputStream</span></span><br><span class="line">I/System<span class="selector-class">.out</span>:        GenericParameterType[<span class="number">1</span>]: class java<span class="selector-class">.lang</span><span class="selector-class">.String</span></span><br><span class="line">I/System<span class="selector-class">.out</span>:       *GenericParameterType[<span class="number">2</span>]: class java<span class="selector-class">.util</span><span class="selector-class">.Locale</span></span><br><span class="line">I/System<span class="selector-class">.out</span>: public java<span class="selector-class">.util</span><span class="selector-class">.Formatter</span>(java<span class="selector-class">.lang</span><span class="selector-class">.Appendable</span>,java<span class="selector-class">.util</span><span class="selector-class">.Locale</span>)</span><br><span class="line">I/System<span class="selector-class">.out</span>:        GenericParameterType[<span class="number">0</span>]: interface java<span class="selector-class">.lang</span><span class="selector-class">.Appendable</span></span><br><span class="line">I/System<span class="selector-class">.out</span>:       *GenericParameterType[<span class="number">1</span>]: class java<span class="selector-class">.util</span><span class="selector-class">.Locale</span></span><br><span class="line">I/System<span class="selector-class">.out</span>: public java<span class="selector-class">.util</span><span class="selector-class">.Formatter</span>(java<span class="selector-class">.lang</span><span class="selector-class">.String</span>,java<span class="selector-class">.lang</span><span class="selector-class">.String</span>,java<span class="selector-class">.util</span><span class="selector-class">.Locale</span>) throws java<span class="selector-class">.io</span><span class="selector-class">.FileNotFoundException</span>,java<span class="selector-class">.io</span><span class="selector-class">.UnsupportedEncodingException</span></span><br><span class="line">I/System<span class="selector-class">.out</span>:        GenericParameterType[<span class="number">0</span>]: class java<span class="selector-class">.lang</span><span class="selector-class">.String</span></span><br><span class="line">I/System<span class="selector-class">.out</span>:        GenericParameterType[<span class="number">1</span>]: class java<span class="selector-class">.lang</span><span class="selector-class">.String</span></span><br><span class="line">I/System<span class="selector-class">.out</span>:       *GenericParameterType[<span class="number">2</span>]: class java<span class="selector-class">.util</span><span class="selector-class">.Locale</span></span><br><span class="line">I/System<span class="selector-class">.out</span>: private java<span class="selector-class">.util</span><span class="selector-class">.Formatter</span>(java<span class="selector-class">.nio</span><span class="selector-class">.charset</span><span class="selector-class">.Charset</span>,java<span class="selector-class">.util</span><span class="selector-class">.Locale</span>,java<span class="selector-class">.io</span><span class="selector-class">.File</span>) throws java<span class="selector-class">.io</span><span class="selector-class">.FileNotFoundException</span></span><br><span class="line">I/System<span class="selector-class">.out</span>:        GenericParameterType[<span class="number">0</span>]: class java<span class="selector-class">.nio</span><span class="selector-class">.charset</span><span class="selector-class">.Charset</span></span><br><span class="line">I/System<span class="selector-class">.out</span>:       *GenericParameterType[<span class="number">1</span>]: class java<span class="selector-class">.util</span><span class="selector-class">.Locale</span></span><br><span class="line">I/System<span class="selector-class">.out</span>:        GenericParameterType[<span class="number">2</span>]: class java<span class="selector-class">.io</span><span class="selector-class">.File</span></span><br><span class="line">I/System<span class="selector-class">.out</span>: public java<span class="selector-class">.util</span><span class="selector-class">.Formatter</span>(java<span class="selector-class">.util</span><span class="selector-class">.Locale</span>)</span><br><span class="line">I/System<span class="selector-class">.out</span>:       *GenericParameterType[<span class="number">0</span>]: class java<span class="selector-class">.util</span><span class="selector-class">.Locale</span></span><br><span class="line">I/System<span class="selector-class">.out</span>: private java<span class="selector-class">.util</span><span class="selector-class">.Formatter</span>(java<span class="selector-class">.util</span><span class="selector-class">.Locale</span>,java<span class="selector-class">.lang</span><span class="selector-class">.Appendable</span>)</span><br><span class="line">I/System<span class="selector-class">.out</span>:       *GenericParameterType[<span class="number">0</span>]: class java<span class="selector-class">.util</span><span class="selector-class">.Locale</span></span><br><span class="line">I/System<span class="selector-class">.out</span>:        GenericParameterType[<span class="number">1</span>]: interface java<span class="selector-class">.lang</span><span class="selector-class">.Appendable</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以看到，和之前method的方法类似，<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Method.html#getGenericParameterTypes--" target="_blank" rel="noopener"><code>Method.getGenericParameterTypes()</code></a> 将查询类文件中的签名属性。</p>
</blockquote>
<p>另一个例子，在String方法中，找到包含char数组的方法</p>
<p>输入：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">constructorSift</span><span class="selector-class">.main</span>(<span class="string">"java.lang.String"</span>, <span class="string">"[C"</span>);</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">I/System<span class="selector-class">.out</span>: java<span class="selector-class">.lang</span><span class="selector-class">.String</span>(int,int,char[])</span><br><span class="line">I/System<span class="selector-class">.out</span>:        GenericParameterType[<span class="number">0</span>]: int</span><br><span class="line">I/System<span class="selector-class">.out</span>:        GenericParameterType[<span class="number">1</span>]: int</span><br><span class="line">I/System<span class="selector-class">.out</span>:       *GenericParameterType[<span class="number">2</span>]: class [C</span><br><span class="line">I/System<span class="selector-class">.out</span>: public java<span class="selector-class">.lang</span><span class="selector-class">.String</span>(char[])</span><br><span class="line">I/System<span class="selector-class">.out</span>:       *GenericParameterType[<span class="number">0</span>]: class [C</span><br><span class="line">I/System<span class="selector-class">.out</span>: public java<span class="selector-class">.lang</span><span class="selector-class">.String</span>(char[],int,int)</span><br><span class="line">I/System<span class="selector-class">.out</span>:       *GenericParameterType[<span class="number">0</span>]: class [C</span><br><span class="line">I/System<span class="selector-class">.out</span>:        GenericParameterType[<span class="number">1</span>]: int</span><br><span class="line">I/System<span class="selector-class">.out</span>:        GenericParameterType[<span class="number">2</span>]: int</span><br></pre></td></tr></table></figure>
<p>数组的表达式和基本类型和<code>Class.getName()</code>是一样的。第一个是private，我们之所以可拿到它是因为我们用了</p>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredConstructors--" target="_blank" rel="noopener"><code>Class.getDeclaredConstructors()</code></a> 这一特征在前面有提到。</p>
<h3 id="构造函数的修饰符"><a href="#构造函数的修饰符" class="headerlink" title="构造函数的修饰符"></a>构造函数的修饰符</h3><p>构造函数的修饰符有</p>
<ul>
<li>访问修饰符: <code>public</code>, <code>protected</code>,  <code>private</code></li>
<li>注解</li>
</ul>
<p>写Demo说明：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import java.lang.reflect.Constructor;</span><br><span class="line">import java.lang.reflect.Modifier;</span><br><span class="line">import <span class="keyword">static</span> java.lang.System.<span class="keyword">out</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConstructorAccess</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String... args</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取类</span></span><br><span class="line">            Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="comment">//获取类的构造函数</span></span><br><span class="line">            Constructor[] allConstructors = c.getDeclaredConstructors();</span><br><span class="line">            <span class="comment">//遍历构造函数</span></span><br><span class="line">            <span class="keyword">for</span> (Constructor ctor : allConstructors) &#123;</span><br><span class="line">                <span class="comment">//获取输入的修饰符</span></span><br><span class="line">                <span class="keyword">int</span> searchMod = modifierFromString(args[<span class="number">1</span>]);</span><br><span class="line">                <span class="comment">//获取修饰符修饰符模式</span></span><br><span class="line">                <span class="keyword">int</span> mods = accessModifiers(ctor.getModifiers());</span><br><span class="line">                <span class="keyword">if</span> (searchMod == mods) &#123;</span><br><span class="line">                    <span class="comment">//输出</span></span><br><span class="line">                    <span class="keyword">out</span>.format(<span class="string">"%s%n"</span>, ctor.toGenericString());</span><br><span class="line">                    <span class="keyword">out</span>.format(<span class="string">"  [ synthetic=%-5b var_args=%-5b ]%n"</span>,</span><br><span class="line">                            ctor.isSynthetic(), ctor.isVarArgs());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">accessModifiers</span>(<span class="params"><span class="keyword">int</span> m</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> m &amp; (Modifier.PUBLIC | Modifier.PRIVATE | Modifier.PROTECTED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">modifierFromString</span>(<span class="params">String s</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"public"</span>.<span class="keyword">equals</span>(s))               <span class="keyword">return</span> Modifier.PUBLIC;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"protected"</span>.<span class="keyword">equals</span>(s))       <span class="keyword">return</span> Modifier.PROTECTED;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"private"</span>.<span class="keyword">equals</span>(s))         <span class="keyword">return</span> Modifier.PRIVATE;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"package-private"</span>.<span class="keyword">equals</span>(s)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里要注意一个修饰符包级的私有，所以要检查三种访问修饰符来确定包级私有构造函数</p>
</blockquote>
<p>在这里我们输入</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">constructorAccess</span><span class="selector-class">.main</span>("<span class="selector-tag">java</span><span class="selector-class">.io</span><span class="selector-class">.File</span>","<span class="selector-tag">private</span>");</span><br></pre></td></tr></table></figure>
<p>得到输出</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">I/System<span class="selector-class">.out</span>: private java<span class="selector-class">.io</span><span class="selector-class">.File</span>(java<span class="selector-class">.lang</span><span class="selector-class">.String</span>,int)</span><br><span class="line">I/System<span class="selector-class">.out</span>:   [ synthetic=false var_args=false ]</span><br><span class="line">I/System<span class="selector-class">.out</span>: private java<span class="selector-class">.io</span><span class="selector-class">.File</span>(java<span class="selector-class">.lang</span><span class="selector-class">.String</span>,java<span class="selector-class">.io</span><span class="selector-class">.File</span>)</span><br><span class="line">I/System<span class="selector-class">.out</span>:   [ synthetic=false var_args=false ]</span><br></pre></td></tr></table></figure>
<p><code>synthetic</code>这个有介绍对于<code>Inner Class</code>来说，编译器在编译的时候回生成一个合成构造函数。包含了一个私有的对外部类的引用。</p>
<h3 id="创建一个Class实例"><a href="#创建一个Class实例" class="headerlink" title="创建一个Class实例"></a>创建一个Class实例</h3><p>构造Class实例有两种办法：<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Constructor.html#newInstance-java.lang.Object...-" target="_blank" rel="noopener"><code>java.lang.reflect.Constructor.newInstance()</code></a> 和 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#newInstance--" target="_blank" rel="noopener"><code>Class.newInstance()</code></a>. </p>
<p>最好使用<code>Constructor.newInstance()</code>，有以下几个原因</p>
<ul>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#newInstance--" target="_blank" rel="noopener"><code>Class.newInstance()</code></a> 只能构造没有参数的Class，<code>Constructor.newInstance()</code>可以调用包含任何参数的构造函数。</li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#newInstance--" target="_blank" rel="noopener"><code>Class.newInstance()</code></a> 不管是检查还是未检查第通过构造函数抛出异常，而<code>Constructor.newInstance()</code>是使用<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/InvocationTargetException.html" target="_blank" rel="noopener"><code>InvocationTargetException</code></a>来包装抛出异常。</li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#newInstance--" target="_blank" rel="noopener"><code>Class.newInstance()</code></a> 要求构造函数是可见的，而<code>Constructor.newInstance()</code>可以调用私有的构造函数。</li>
</ul>
<p>对于<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#newInstance--" target="_blank" rel="noopener"><code>Class.newInstance()</code></a>的实现来说相对简单，这里就不再举例，那么对于用构造函数来创建对象的方法在这里给出一个Demo</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmailAliases</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;<span class="keyword">String</span>&gt; aliases;</span><br><span class="line">    <span class="keyword">private</span> EmailAliases(HashMap&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; h) &#123;</span><br><span class="line">	aliases = h.keySet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> void printKeys() &#123;</span><br><span class="line">	out.format(<span class="string">"Mail keys:%n"</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">String</span> k : <span class="type">aliases</span>)</span><br><span class="line">	    out.format(<span class="string">"  %s%n"</span>, k);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestoreAliases</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; defaultAliases = <span class="keyword">new</span> <span class="type">HashMap</span>&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">	defaultAliases.put(<span class="string">"Duke"</span>, <span class="string">"duke@i-love-java"</span>);</span><br><span class="line">	defaultAliases.put(<span class="string">"Fang"</span>, <span class="string">"fang@evil-jealous-twin"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="keyword">String</span>... args) &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    Constructor ctor = EmailAliases.class.getDeclaredConstructor(HashMap.class);</span><br><span class="line">	    ctor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">	    EmailAliases email = (EmailAliases)ctor.<span class="keyword">new</span><span class="type">Instance</span>(defaultAliases);</span><br><span class="line">	    email.printKeys();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (InstantiationException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (InvocationTargetException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (NoSuchMethodException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用<code>main</code>方法我们得到</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">I/System.<span class="keyword">ou</span><span class="variable">t:</span> Mail key<span class="variable">s:</span></span><br><span class="line">I/System.<span class="keyword">ou</span><span class="variable">t:</span>   Fang</span><br><span class="line">I/System.<span class="keyword">ou</span><span class="variable">t:</span>   Duke</span><br></pre></td></tr></table></figure>
<p>此示例使用<code>Class.getDeclaredConstructor()</code>来查找具有<code>java.util.HashMap</code>类型的单个参数的构造函数。</p>
<p>这里我们看到我们使用</p>
<p><code>EmailAliases.class.getDeclaredConstructor(HashMap.class);</code>来获取了构造函数，为什么没有传递<code>HashMap</code>里面的类型呢？这是因为类型擦除，下面的代码会返回true:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HashMap<span class="selector-class">.class</span> == defaultAliases.getClass()</span><br></pre></td></tr></table></figure>
<h3 id="构造异常"><a href="#构造异常" class="headerlink" title="构造异常"></a>构造异常</h3><h4 id="InstantiationException"><a href="#InstantiationException" class="headerlink" title="InstantiationException"></a>InstantiationException</h4><p><code>Class.newInstance()</code>缺少零参的构造函数</p>
<h4 id="Unexpected-Exception"><a href="#Unexpected-Exception" class="headerlink" title="Unexpected Exception"></a>Unexpected Exception</h4><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.err;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstructorTroubleToo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> ConstructorTroubleToo() &#123;</span><br><span class="line"> 	<span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">RuntimeException</span>(<span class="string">"exception in constructor"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="keyword">String</span>... args) &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    Class&lt;?&gt; c = Class.forName(<span class="string">"ConstructorTroubleToo"</span>);</span><br><span class="line">	    <span class="comment">// Method propagetes any exception thrown by the constructor</span></span><br><span class="line">	    <span class="comment">// (including checked exceptions).</span></span><br><span class="line">	    <span class="keyword">if</span> (args.length &gt; <span class="number">0</span> &amp;&amp; args[<span class="number">0</span>].equals(<span class="string">"class"</span>)) &#123;</span><br><span class="line">		Object o = c.<span class="keyword">new</span><span class="type">Instance</span>();</span><br><span class="line">	    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		Object o = c.getConstructor().<span class="keyword">new</span><span class="type">Instance</span>();</span><br><span class="line">	    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (InstantiationException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (NoSuchMethodException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (InvocationTargetException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	    err.format(<span class="string">"%n%nCaught exception: %s%n"</span>, x.getCause());</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果调用</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ConstructorTroubleToo.main(“<span class="class"><span class="keyword">class</span>”);</span></span><br></pre></td></tr></table></figure>
<p>则会抛出异常    </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java<span class="selector-class">.lang</span><span class="selector-class">.RuntimeException</span>: exception <span class="keyword">in</span> constructor</span><br><span class="line">        at lab<span class="selector-class">.mon</span><span class="selector-class">.actlab</span><span class="selector-class">.java</span><span class="selector-class">.reflect</span><span class="selector-class">.construct</span><span class="selector-class">.ConstructorTroubleToo</span>.&lt;init&gt;(ConstructorTroubleToo<span class="selector-class">.java</span>:<span class="number">9</span>)</span><br><span class="line">        at java<span class="selector-class">.lang</span><span class="selector-class">.Class</span><span class="selector-class">.newInstance</span>(Native Method)</span><br><span class="line">        at lab<span class="selector-class">.mon</span><span class="selector-class">.actlab</span><span class="selector-class">.java</span><span class="selector-class">.reflect</span><span class="selector-class">.construct</span><span class="selector-class">.ConstructorTroubleToo</span><span class="selector-class">.main</span>(ConstructorTroubleToo<span class="selector-class">.java</span>:<span class="number">18</span>)</span><br><span class="line">        at lab<span class="selector-class">.mon</span><span class="selector-class">.actlab</span><span class="selector-class">.java</span><span class="selector-class">.reflect</span><span class="selector-class">.ReflectActivity</span><span class="selector-class">.onResume</span>(ReflectActivity<span class="selector-class">.java</span>:<span class="number">96</span>)</span><br><span class="line">        at android<span class="selector-class">.app</span><span class="selector-class">.Instrumentation</span><span class="selector-class">.callActivityOnResume</span>(Instrumentation<span class="selector-class">.java</span>:<span class="number">1354</span>)</span><br><span class="line">        at android<span class="selector-class">.app</span><span class="selector-class">.Activity</span><span class="selector-class">.performResume</span>(Activity<span class="selector-class">.java</span>:<span class="number">7079</span>)</span><br></pre></td></tr></table></figure>
<p>如果调用</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ConstructorTroubleToo.main()<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">W/System<span class="selector-class">.err</span>: java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.InvocationTargetException</span></span><br><span class="line">W/System<span class="selector-class">.err</span>:     at java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.Constructor</span><span class="selector-class">.newInstance0</span>(Native Method)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.Constructor</span><span class="selector-class">.newInstance</span>(Constructor<span class="selector-class">.java</span>:<span class="number">334</span>)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at lab<span class="selector-class">.mon</span><span class="selector-class">.actlab</span><span class="selector-class">.java</span><span class="selector-class">.reflect</span><span class="selector-class">.construct</span><span class="selector-class">.ConstructorTroubleToo</span><span class="selector-class">.main</span>(ConstructorTroubleToo<span class="selector-class">.java</span>:<span class="number">20</span>)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at lab<span class="selector-class">.mon</span><span class="selector-class">.actlab</span><span class="selector-class">.java</span><span class="selector-class">.reflect</span><span class="selector-class">.ReflectActivity</span><span class="selector-class">.onResume</span>(ReflectActivity<span class="selector-class">.java</span>:<span class="number">96</span>)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at android<span class="selector-class">.app</span><span class="selector-class">.Instrumentation</span><span class="selector-class">.callActivityOnResume</span>(Instrumentation<span class="selector-class">.java</span>:<span class="number">1354</span>)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at android<span class="selector-class">.app</span><span class="selector-class">.Activity</span><span class="selector-class">.performResume</span>(Activity<span class="selector-class">.java</span>:<span class="number">7079</span>)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at android<span class="selector-class">.app</span><span class="selector-class">.ActivityThread</span><span class="selector-class">.performResumeActivity</span>(ActivityThread<span class="selector-class">.java</span>:<span class="number">3620</span>)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at android<span class="selector-class">.app</span><span class="selector-class">.ActivityThread</span><span class="selector-class">.handleResumeActivity</span>(ActivityThread<span class="selector-class">.java</span>:<span class="number">3685</span>)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at android<span class="selector-class">.app</span><span class="selector-class">.ActivityThread</span><span class="selector-class">.handleLaunchActivity</span>(ActivityThread<span class="selector-class">.java</span>:<span class="number">2898</span>)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at android<span class="selector-class">.app</span><span class="selector-class">.ActivityThread</span>.-wrap11(Unknown Source:<span class="number">0</span>)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at android<span class="selector-class">.app</span><span class="selector-class">.ActivityThread</span><span class="variable">$H</span>.handleMessage(ActivityThread<span class="selector-class">.java</span>:<span class="number">1593</span>)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at android<span class="selector-class">.os</span><span class="selector-class">.Handler</span><span class="selector-class">.dispatchMessage</span>(Handler<span class="selector-class">.java</span>:<span class="number">105</span>)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at android<span class="selector-class">.os</span><span class="selector-class">.Looper</span><span class="selector-class">.loop</span>(Looper<span class="selector-class">.java</span>:<span class="number">164</span>)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at android<span class="selector-class">.app</span><span class="selector-class">.ActivityThread</span><span class="selector-class">.main</span>(ActivityThread<span class="selector-class">.java</span>:<span class="number">6541</span>)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.Method</span><span class="selector-class">.invoke</span>(Native Method)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at com<span class="selector-class">.android</span><span class="selector-class">.internal</span><span class="selector-class">.os</span><span class="selector-class">.Zygote</span><span class="variable">$MethodAndArgsCaller</span>.run(Zygote<span class="selector-class">.java</span>:<span class="number">240</span>)</span><br><span class="line">W/System<span class="selector-class">.err</span>:     at com<span class="selector-class">.android</span><span class="selector-class">.internal</span><span class="selector-class">.os</span><span class="selector-class">.ZygoteInit</span><span class="selector-class">.main</span>(ZygoteInit<span class="selector-class">.java</span>:<span class="number">767</span>)</span><br></pre></td></tr></table></figure>
<p>则会抛出异常，但是构造函数将被创建，不会崩溃，而且如果想要捕获异常，只需要调用<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/InvocationTargetException.html#getCause--" target="_blank" rel="noopener"><code>InvocationTargetException.getCause()</code></a>.即可，这就是之前所说的使用 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Constructor.html#newInstance-java.lang.Object…-" target="_blank" rel="noopener"><code>Constructor.newInstance()</code></a>比 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#newInstance--" target="_blank" rel="noopener"><code>Class.newInstance()</code></a>好的地方，它可以检查和处理构造函数抛出的异常。</p>
<h4 id="定位构造函数出现的问题"><a href="#定位构造函数出现的问题" class="headerlink" title="定位构造函数出现的问题"></a>定位构造函数出现的问题</h4><p>如果我们要捕获创建构造函数时出现的问题，我们则需要直接调用<code>trycache</code>即可如一下Demo</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">import java.lang.reflect.InvocationTargetException;</span><br><span class="line"></span><br><span class="line">import <span class="keyword">static</span> java.lang.System.<span class="keyword">out</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConstructorTroubleAgain</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConstructorTroubleAgain</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConstructorTroubleAgain</span>(<span class="params">Integer i</span>)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConstructorTroubleAgain</span>(<span class="params">Object o</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">out</span>.format(<span class="string">"Constructor passed Object%n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConstructorTroubleAgain</span>(<span class="params">String s</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">out</span>.format(<span class="string">"Constructor passed String%n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String... args</span>)</span> &#123;</span><br><span class="line">        String argType = (args.length == <span class="number">0</span> ? <span class="string">""</span> : args[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; c = Class.forName(ConstructorTroubleAgain.class.getName());</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">""</span>.<span class="keyword">equals</span>(argType)) &#123;</span><br><span class="line">                <span class="comment">// IllegalArgumentException: wrong number of arguments</span></span><br><span class="line">                Object o = c.getConstructor().newInstance(<span class="string">"foo"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"int"</span>.<span class="keyword">equals</span>(argType)) &#123;</span><br><span class="line">                <span class="comment">// NoSuchMethodException</span></span><br><span class="line">                Object o = c.getConstructor(<span class="keyword">int</span>.class);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"Object"</span>.<span class="keyword">equals</span>(argType)) &#123;</span><br><span class="line">                Object o = c.getConstructor(Object.class).newInstance(<span class="string">"foo"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                assert <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们分别调用三种传值来查看这几种异常</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ConstructorTroubleAgain.main()<span class="comment">;</span></span><br><span class="line">ConstructorTroubleAgain.main(<span class="string">"int"</span>)<span class="comment">;</span></span><br><span class="line">ConstructorTroubleAgain.main(<span class="string">"Object"</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>捕获三种崩溃</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused <span class="keyword">by</span>: java.lang.IllegalArgumentException: Wrong <span class="built_in">number</span> <span class="keyword">of</span> arguments; expected <span class="number">0</span>, got <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>是因为参数个数错误导致的,获取的是无参的构造函数，但是调用是有参数的。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">W/System<span class="selector-class">.err</span>: java<span class="selector-class">.lang</span><span class="selector-class">.NoSuchMethodException</span>: &lt;init&gt; [int]</span><br></pre></td></tr></table></figure>
<p>Java在反射中，基本类型一般是不会box和unbox的（基本类型转换为引用类型）。</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I/System.<span class="keyword">out</span>: <span class="function"><span class="keyword">Constructor</span> <span class="title">passed</span> <span class="title">Object</span></span></span><br></pre></td></tr></table></figure>
<p>第三个中虽然调用传递参数了<code>string</code>构造函数，但是依然调用了<code>Object</code></p>
<h4 id="IllegalAccessException-1"><a href="#IllegalAccessException-1" class="headerlink" title="IllegalAccessException"></a>IllegalAccessException</h4><p>一般出现这种异常是因为调用了私有的构造函数，只要我们像方法一样调用<code>setAccessible(true)</code>就可以解决。</p>

      
    </div>
    
    
    
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>谢谢您的鼓励~</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="田昊 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="田昊 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/反射/" rel="tag"># 反射</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/08/14/Reflect-1/" rel="next" title="反射三步曲之一介绍反射和Class">
                <i class="fa fa-chevron-left"></i> 反射三步曲之一介绍反射和Class
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/08/21/Reflect-3/" rel="prev" title="反射三步曲之三反射数组和枚举">
                反射三步曲之三反射数组和枚举 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="田昊">
            
              <p class="site-author-name" itemprop="name">田昊</p>
              <p class="site-description motion-element" itemprop="description">一个对技术有态度的程序员</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">62</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/THtianhao" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="envelope" target="_blank" title="E-Mail tototianhao@gmail.com">
                      
                        <i class="fa fa-fw fa-globe"></i>E-Mail tototianhao@gmail.com</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="undefined" target="_blank" title="QQ 356831631">
                      
                        <i class="fa fa-fw fa-globe"></i>QQ 356831631</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="undefined" target="_blank" title="tel 13233422221">
                      
                        <i class="fa fa-fw fa-globe"></i>tel 13233422221</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="undefined" target="_blank" title="weChat toto000888">
                      
                        <i class="fa fa-fw fa-globe"></i>weChat toto000888</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#反射成员"><span class="nav-number">1.</span> <span class="nav-text">反射成员</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#字段（Field）"><span class="nav-number">1.1.</span> <span class="nav-text">字段（Field）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是字段？"><span class="nav-number">1.1.1.</span> <span class="nav-text">什么是字段？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取字段的类型"><span class="nav-number">1.1.2.</span> <span class="nav-text">获取字段的类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#取得、解析字段的修饰符"><span class="nav-number">1.1.3.</span> <span class="nav-text">取得、解析字段的修饰符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#get或者set-字段的值"><span class="nav-number">1.1.4.</span> <span class="nav-text">get或者set 字段的值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#操作时的故障"><span class="nav-number">1.1.5.</span> <span class="nav-text">操作时的故障</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方法"><span class="nav-number">1.2.</span> <span class="nav-text">方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#获取方法类型信息"><span class="nav-number">1.2.1.</span> <span class="nav-text">获取方法类型信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取方法的名称"><span class="nav-number">1.2.2.</span> <span class="nav-text">获取方法的名称</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#隐式和合成参数"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">隐式和合成参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检索或解析方法的修饰符"><span class="nav-number">1.2.3.</span> <span class="nav-text">检索或解析方法的修饰符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调用方法"><span class="nav-number">1.2.4.</span> <span class="nav-text">调用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#调用普通方法"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">调用普通方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#调用可变数量的参数"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">调用可变数量的参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法的异常"><span class="nav-number">1.2.5.</span> <span class="nav-text">方法的异常</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#NoSuchMethodException"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">NoSuchMethodException</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IllegalAccessException"><span class="nav-number">1.2.5.2.</span> <span class="nav-text">IllegalAccessException</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IllegalArgumentException"><span class="nav-number">1.2.5.3.</span> <span class="nav-text">IllegalArgumentException</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#构造函数"><span class="nav-number">1.3.</span> <span class="nav-text">构造函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#构造函数的修饰符"><span class="nav-number">1.3.1.</span> <span class="nav-text">构造函数的修饰符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建一个Class实例"><span class="nav-number">1.3.2.</span> <span class="nav-text">创建一个Class实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#构造异常"><span class="nav-number">1.3.3.</span> <span class="nav-text">构造异常</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#InstantiationException"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">InstantiationException</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Unexpected-Exception"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">Unexpected Exception</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#定位构造函数出现的问题"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">定位构造函数出现的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IllegalAccessException-1"><span class="nav-number">1.3.3.4.</span> <span class="nav-text">IllegalAccessException</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">一点零点零</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">94.1k</span>
  
</div>










  <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize("");
    }
  </script>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'HLUXSB6s2sdrSljlaJgMe8x8-gzGzoHsz',
        appKey: 'vaOKTphb8yk9eoDDp5NvC6Ip',
        placeholder: 'ヾﾉ≧∀≦)o 来呀！快活呀！~',
        avatar:'/upload/avatar.jpg',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
